<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>装备修理信息化控制平台</title>
	<link href="layui/css/layui.css" rel="stylesheet" />
	<script type="text/javascript" src="js/jquery.js"></script>
	<script type="text/javascript" src="js/checklogin.js"></script>
	<link rel="stylesheet" href="css/main.css">
	<script>
		// 非法登录拦截
		//const no = checkLog();

		// 初始化加载
		$(function () {

			try {
				var strName = sessionStorage.getItem('userName');
				var numType = Number(sessionStorage.getItem('userType'));
				var strType = '用户';
				switch (numType) {
					case 0:
						strType = '超级管理员';
						break;
					case 1:
						strType = '主任务管理员';
						var divD = document.getElementById('3');                // 隐藏零部件维修表
						divD.style.display = 'none';
						break;
					case 2:
						strType = '子任务管理员';
						var divD = document.getElementById('1');                // 隐藏主任务维修表
						divD.style.display = 'none';
						break;
					case 3:
						strType = '维修人员';
						var divD = document.getElementById('1');                // 隐藏主任务、子任务维修表
						divD.style.display = 'none';
						divD = document.getElementById('2');
						divD.style.display = 'none';
						break;
					default:
						alert('没有此用户类型' + numType);
				}
				var strMsg = strName + '[' + strType + ']'
				$("#user").html(strMsg);
			}
			catch (ex) {
				alert(ex.message);
			}

		});
	</script>
	<style>
		.site-active:hover {
			cursor: pointer;
		}
		.login-out:hover {
			cursor: pointer;
		}
		.user-trans:hover {
			cursor: pointer;
		}
	</style>
</head>

<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header">
			<div class="layui-logo">装备修理信息化控制平台</div>
			<!-- 头部区域（可配合layui已有的水平导航） -->
			<ul class="layui-nav layui-layout-left">
				<li class="layui-nav-item"><a href="">控制台</a></li>
				<li class="layui-nav-item"><a href="">管理</a></li>
				<li class="layui-nav-item"><a href="">用户</a></li>
				<li class="layui-nav-item">
					<a href="javascript:;">其它系统</a>
					<dl class="layui-nav-child">
						<dd><a href="">邮件管理</a></dd>
						<dd><a href="">消息管理</a></dd>
						<dd><a href="">授权管理</a></dd>
					</dl>
				</li>
			</ul>
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item">
					<a href="javascript:;">
						<h4 id="user">当前用户</h4>
					</a>
					<dl class="layui-nav-child">
						<dd><a class="site-active" tab-name="基本资料" tab-url="user-info.html" tab-layid="10">基本资料</a></dd>
						<dd><a class="site-active" tab-name="修改密码" tab-url="user-pwd.html" tab-layid="11">修改密码</a></dd>
					</dl>
				</li>
				<li class="layui-nav-item">
					<a href="javascript:;">
						<h4 title="菜单更改显示">切换用户</h4>
					</a>
					<dl class="layui-nav-child">
						<dd><a class="user-trans" type-id="0">超级管理员</a></dd>
						<dd><a class="user-trans" type-id="1">主任务管理员</a></dd>
						<dd><a class="user-trans" type-id="2">子任务管理员</a></dd>
						<dd><a class="user-trans" type-id="3">维修人员</a></dd>
						<dd><hr></dd>
						<dd><a href="javascript:;" class="login-out">退出</a></dd>
					</dl>
				</li>
			</ul>
		</div>

		<div class="layui-side layui-bg-black">
			<div class="layui-side-scroll">
				<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
				<ul class="layui-nav layui-nav-tree" lay-filter="test">
					<li class="layui-nav-item layui-nav-itemed">
						<a class="" href="javascript:;">维修任务管理</a>
						<dl class="layui-nav-child">
							<dd id="1"><a class="site-active" tab-name="主任务维修表" tab-url="main.html" tab-layid="1">主任务维修表</a></dd>
							<dd id="2"><a class="site-active" tab-name="子任务维修表" tab-url="sub.html" tab-layid="2">子任务维修表</a></dd>
							<dd id="3"><a class="site-active" tab-name="零部件维修表" tab-url="part.html" tab-layid="3">零部件维修表</a></dd>

						</dl>
					</li>
					<li class="layui-nav-item">
						<a href="javascript:;">装备信息管理</a>
						<dl class="layui-nav-child">
							<dd><a class="site-active" tab-name="雷达信息" tab-url="radarinfo.html" tab-layid="6">雷达信息</a></dd>
							<dd><a class="site-active" tab-name="零部件信息" tab-url="partinfo.html" tab-layid="7">零部件信息</a></dd>
							<dd><a class="site-active" tab-name="超链接" tab-url="" tab-layid="8">超链接</a></dd>
						</dl>
					</li>
					<li class="layui-nav-item">
						<a href="javascript:;">用户管理</a>
						<dl class="layui-nav-child">
							<dd><a class="site-active" tab-name="基本资料" tab-url="user-info.html" tab-layid="10">基本资料</a></dd>
							<dd><a class="site-active" tab-name="修改密码" tab-url="user-pwd.html" tab-layid="11">修改密码</a></dd>
						</dl>
					</li>
					<li class="layui-nav-item"><a href="">系统设置</a></li>
				</ul>
			</div>
		</div>

		<div class="layui-body">
			<!-- 内容主体区域 -->
			<div layui-body style="padding: 15px;">
				<div class="layui-tab layui-tab-brief" lay-allowClose="true" lay-filter="tabList">
					<ul class="layui-tab-title">
						<li class="layui-this welcome">
							主页
						</li>
					</ul>
					<div class="layui-tab-content"  >
						<div class="layui-tab-item layui-show" style="background: #f5f5f5;" >
							<iframe src="welcome.html" height="1000px" width="100%"  frameborder="0"></iframe>
						</div>
					</div>
				</div>
			</div>

		</div>

		<div class="layui-footer">
			<!-- 底部固定区域 -->
			© 装备修理信息化控制平台 - 底部固定区域
		</div>
	</div>
	<script type="text/javascript" src="layui/layui.js"></script>

	<script>

		//JavaScript代码区域
		layui.use(['element', 'jquery'], function () {
			var element = layui.element,
				$ = layui.jquery;

			//触发事件
			var active = {
				tabAdd: function (name, url, layid) {
					element.tabAdd('tabList', {
						title: name //'选项卡的标题'
						, content: '<iframe id="iframeMain" style="width: 100%" ; height="100%" ; scrolling="no" frameborder="no" src="' + url + '"></iframe>'//'选项卡的内容' //支持传入html
						, id: layid//'选项卡标题的lay-id属性值'
					});
				},
				tabChange: function (layid) {
					element.tabChange('tabList', layid);
				},
				tabDelete: function (layid) {
					element.tabDelete('tabList', layid);
				}
			}

			//当点击有site-active属性的标签时，即左侧菜单栏中内容 ，触发点击事件
			$('.site-active', '').on("click", function () {
				var dataid = $(this);
				var name = dataid.attr("tab-name");
				var url = dataid.attr("tab-url");
				var tab_layid = dataid.attr("tab-layid");


				//1、 判断tab-layid=layid的tab页是否打开
				if ($(".layui-tab-title li[lay-id]").length <= 0) { //1.1 初始状态：1个Tab页也没有打开
					//alert(11111111111111)
					active.tabAdd(name, url, tab_layid); //打开tab页
					active.tabChange(tab_layid)//转到该tab页
				} else { //1.2   判断该Tab页是否已打开
					var isData = false; //初始化一个标志，为false说明未打开该tab项 为true则说明已有
					$.each($(".layui-tab-title li[lay-id]"), function () {

						//如果点击左侧菜单栏所传入的id 在右侧tab项中的lay-id属性可以找到，则说明该tab项已经打开
						if ($(this).attr("lay-id") == tab_layid) {
							isData = true;

						}
					})
					if (isData == false) {
						//标志为false 新增一个tab项
						active.tabAdd(name, url, tab_layid); //1.2.1  该Tab页未打开，则打开该tab页
					}

					active.tabChange(tab_layid)//1.2.2 转到该tab页
				}


				FrameWH();  //计算ifram层的大小

			});


			function FrameWH() { //计算ifram层的大小
				var h = $(window).height() - 41 - 10 - 60 - 10 - 44 - 10;
				$("iframe").css("height", h + "px");
			}

			$(window).resize(function () {
				FrameWH();
			})

			// 切换用户
			$('.user-trans').on("click", function () {
				var type = $(this).attr("type-id");
				sessionStorage.setItem('userType',type);
				window.location.reload();
			})

			// 退出登录
			$('.login-out').on("click", function () {
				window.location.href = 'login.html';
			})

		});

	</script>
</body>

</html>